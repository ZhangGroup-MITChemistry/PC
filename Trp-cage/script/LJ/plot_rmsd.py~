import mdtraj
import argparse
import math
import pickle
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages
from sys import exit

parser = argparse.ArgumentParser()
parser.add_argument('--name', type = str, default = '2JOF')
args = parser.parse_args()

name = args.name
print(f"name: {name}")

psf = mdtraj.load_psf(f"./data/structures/{name}/{name}.psf")
traj_md = mdtraj.load_dcd(f"./data/traj_CG/{name}.dcd", psf)
traj_im = mdtraj.load_dcd(f"./output/{name}/im/CG_simulations/traj.dcd", psf)
traj_ref = mdtraj.load_xyz(f"./output/{name}/md/reference_structure.xyz", psf)

rmsd_md = mdtraj.rmsd(traj_md, traj_ref)
rmsd_im = mdtraj.rmsd(traj_im, traj_ref)

helix_particle_index = set(range(2, 14))

weight_decay_list = [1e-8, 2e-8, 5e-8, 1e-7, 2e-7, 5e-7, 1e-6, 2e-6, 5e-6]
with PdfPages(f"./output/{name}/LJ/rmsd.pdf") as pdf:
    for weight_decay in weight_decay_list:
        traj_lj = mdtraj.load_dcd(f"./output/{name}/LJ/CG_simulations/weight_decay_{weight_decay:.3E}.dcd", psf)
        rmsd_lj = mdtraj.rmsd(traj_lj, traj_ref)

        fig = plt.figure()
        fig.clf()
        
        plt.hist(rmsd_md, bins = 40, alpha = 0.5, label = 'md', density = True)
        plt.hist(rmsd_im, bins = 40, alpha = 0.5, label = 'im', density = True)
        plt.hist(rmsd_lj, bins = 40, alpha = 0.5, label = 'lj', density = True)        

        plt.legend()
        plt.title(f"weight_decay: {weight_decay:.3E}")
        pdf.savefig()
        plt.close()

        print(weight_decay)
exit()

rmsd_helix_md = mdtraj.rmsd(traj_md, traj_ref, atom_indices = list(helix_particle_index))
rmsd_helix_im = mdtraj.rmsd(traj_im, traj_ref, atom_indices = list(helix_particle_index))


fig = plt.figure(0)
fig.clf()
plt.hist(rmsd_helix_md, bins = 40, alpha = 0.5, label = 'md', density = True)
plt.hist(rmsd_helix_im, bins = 40, alpha = 0.5, label = 'im', density = True)
plt.savefig(f"./output/{name}/im/rmsd_helix_hist.pdf")

fig = plt.figure(0)
fig.clf()
plt.hist(rmsd_md, bins = 40, alpha = 0.5, label = 'md', density = True)
plt.hist(rmsd_im, bins = 40, alpha = 0.5, label = 'im', density = True)
plt.savefig(f"./output/{name}/im/rmsd_hist.pdf")

